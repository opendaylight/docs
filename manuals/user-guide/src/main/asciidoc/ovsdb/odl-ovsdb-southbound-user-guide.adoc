==== OVSDB SouthBound Plugin

The OVSDB southbound plugin provides support for managing OVS hosts
via an OVSDB model in the MD-SAL which maps to important tables and
attributes present in the Open vSwitch schema.  The OVSDB southbound plugin
is able to connect actively or passively to OVS hosts and operate
as the OVSDB manager of the OVS host.  Using the OVSDB protocol it is able
to manage the OVS database (OVSDB) on the OVS host as defined by the Open vSwitch schema.

===== OVSDB Yang Model

The OVSDB southbound plugin provides a YANG model which is based on the
abstract 
https://github.com/opendaylight/yangtools/blob/stable/lithium/model/ietf/ietf-topology/src/main/yang/network-topology%402013-10-21.yang[network topology model].

The details of the OVSDB YANG model are defined in the
https://github.com/opendaylight/ovsdb/blob/stable/lithium/southbound/southbound-api/src/main/yang/ovsdb.yang[ovsdb.yang] file.

The OVSDB YANG model defines three augmentations:

*ovsdb-node-augmentation*::
This augments the network-topology node and maps primarily to the Open_vSwitch table of
the OVSDB schema.  The ovsdb-node-augmentation is a representation of the OVS host.  It contains the following attributes.
  * *connection-info* - holds the local and remote IP address and TCP port numbers for the OpenDaylight to OVSDB node connections
  * *db-version* - version of the OVSDB database
  * *ovs-version* - version of OVS
  * *list managed-node-entry* - a list of references to ovsdb-bridge-augmentation nodes, which are the OVS bridges managed by this OVSDB node
  * *list datapath-type-entry* - a list of the datapath types supported by the OVSDB node (e.g. 'system', 'netdev') - depends on newer OVS versions
  * *list interface-type-entry* - a list of the interface types supported by the OVSDB node (e.g. 'internal', 'vxlan', 'gre', 'dpdk', etc.) - depends on newer OVS verions
  * *list openvswitch-external-ids* - a list of the key/value pairs in the Open_vSwitch table external_ids column
  * *list openvswitch-other-config* - a list of the key/value pairs in the Open_vSwitch table other_config column
  * *list managery-entry* - list of manager information entries and connection status
  * *list qos-entries* - list of Qos entries present in the Qos table
  * *list queues* - list of queue entries present in the queue table
*ovsdb-bridge-augmentation*::
This augments the network-topology node and maps to an specific bridge in the OVSDB
bridge table of the associated OVSDB node. It contains the following attributes.
  * *bridge-uuid* - UUID of the OVSDB bridge
  * *bridge-name* - name of the OVSDB bridge
  * *bridge-openflow-node-ref* - a reference (instance-identifier) of the OpenFlow node associated with this bridge
  * *list protocol-entry* - the version of OpenFlow protocol to use with the OpenFlow controller
  * *list controller-entry* - a list of controller-uuid and is-connected status of the OpenFlow controllers associated with this bridge
  * *datapath-id* - the datapath ID associated with this bridge on the OVSDB node
  * *datapath-type* - the datapath type of this bridge
  * *fail-mode* - the OVSDB fail mode setting of this bridge
  * *flow-node* - a reference to the flow node corresponding to this bridge
  * *managed-by* - a reference to the ovsdb-node-augmentation (OVSDB node) that is managing this bridge
  * *list bridge-external-ids* - a list of the key/value pairs in the bridge table external_ids column for this bridge
  * *list bridge-other-configs* - a list of the key/value pairs in the bridge table other_config column for this bridge
*ovsdb-termination-point-augmentation*::
This augments the topology termination point model.  The OVSDB southbound
plugin uses this model to represent both the OVSDB port and OVSDB interface for
a given port/interface in the OVSDB schema.  It contains the following
attributes.
  * *port-uuid* - UUID of an OVSDB port row
  * *interface-uuid* - UUID of an OVSDB interface row
  * *name* - name of the port and interface
  * *interface-type* - the interface type
  * *list options* - a list of port options
  * *ofport* - the OpenFlow port number of the interface
  * *ofport_request* - the requested OpenFlow port number for the interface
  * *vlan-tag* - the VLAN tag value
  * *list trunks* - list of VLAN tag values for trunk mode
  * *vlan-mode* - the VLAN mode (e.g. access, native-tagged, native-untagged, trunk)
  * *list port-external-ids* - a list of the key/value pairs in the port table external_ids column for this port
  * *list interface-external-ids* - a list of the key/value pairs in the interface table external_ids interface for this interface
  * *list port-other-configs* - a list of the key/value pairs in the port table other_config column for this port
  * *list interface-other-configs* - a list of the key/value pairs in the interface table other_config column for this interface
  * *list inteface-lldp* - LLDP Auto Attach configuration for the interface
  * *qos* - UUID of the Qos entry in the Qos table assigned to this port

===== Getting Started

Once the Opendaylight controller is started, ensure that the OVSDB southbound plugin is installed from the karaf shell.

 opendaylight-user@root>feature:list | grep odl-ovsdb-southbound
 odl-ovsdb-southbound-api                      | 1.2.1-SNAPSHOT   |           | odl-ovsdb-southbound-1.2.1-SNAPSHOT        | OpenDaylight :: southbound :: api           
 odl-ovsdb-southbound-impl                     | 1.2.1-SNAPSHOT   |           | odl-ovsdb-southbound-1.2.1-SNAPSHOT        | OpenDaylight :: southbound :: impl          
 odl-ovsdb-southbound-impl-rest                | 1.2.1-SNAPSHOT   |           | odl-ovsdb-southbound-1.2.1-SNAPSHOT        | OpenDaylight :: southbound :: impl :: REST  
 odl-ovsdb-southbound-impl-ui                  | 1.2.1-SNAPSHOT   |           | odl-ovsdb-southbound-1.2.1-SNAPSHOT        | OpenDaylight :: southbound :: impl :: UI    
 odl-ovsdb-southbound-test                     | 1.2.1-SNAPSHOT   |           | odl-ovsdb-southbound-1.2.1-SNAPSHOT        | OpenDaylight :: southbound :: test       

If 'x' is not present in the third column, then install the OVSDB southbound plugin.

 opendaylight-user@root>feature:install odl-ovsdb-southbound-impl-ui

After installing the OVSDB southbound plugin, and before any OVSDB topology nodes have been created,
the OVSDB topology will appear as follows in the configuration and operational MD-SAL.

HTTP GET:

 http://{{CONTROLLER-IP}}:8181/restconf/config/network-topology:network-topology/topology/ovsdb:1/
  or
 http://{{CONTROLLER-IP}}:8181/restconf/operational/network-topology:network-topology/topology/ovsdb:1/

Result Body:

 {
   "topology": [
     {
       "topology-id": "ovsdb:1"
     }
   ]
 }

Where

 {{CONTROLLER-IP}}          is the IP address of the Opendaylight controller

===== Opendaylight as the OVSDB Manager

An OVS host is a system which is running the OVS software and is capable of being managed
by an OVSDB manager.  The OVSDB southbound plugin is capable of connecting to
and OVS host and operating as an OVSDB manager.  Depending on the configuration of the
OVS host, the connection of Opendaylight to the OVS host will be active or passive.

===== Active Connection to OVS Hosts

An active connection is when the OVSDB southbound plugin initiates the connection to
an OVS host.  This happens when the OVS host is configured to listen for the
connection (i.e. the OVSDB southbound plugin is active the the OVS host is passive).
The OVS host is configured with the following command:

 sudo ovs-vsctl set-manager ptcp:6640

This configures the OVS host to listen on TCP port 6640.

The OVSDB southbound plugin can be configured via the configuration MD-SAL to
actively connect to an OVS host.

HTTP PUT:

 http://{{CONTROLLER-IP}}:8181/restconf/config/network-topology:network-topology/topology/ovsdb:1/node/ovsdb:%2F%2FHOST1

Body:

 {
   "network-topology:node": [
     {
       "node-id": "ovsdb://HOST1",
       "connection-info": {
         "ovsdb:remote-port": "6640",
         "ovsdb:remote-ip": "{{OVS-HOST-IP}}"
       }
     }
   ]
 }

Where

 {{OVS-HOST-IP}}          is the IP address of the OVS Host


Note that the configuration assigns the 'node-id' of "ovsdb://HOST1" to the OVSDB node.
This 'node-id' will be used as the identifier for this OVSDB node in the MD-SAL.

Query the configuration MD-SAL for the OVSDB topology.

HTTP GET:
 
 http://{{CONTROLLER-IP}}:8181/restconf/config/network-topology:network-topology/topology/ovsdb:1/

Result Body:

 {
   "topology": [
     {
       "topology-id": "ovsdb:1",
       "node": [
         {
           "node-id": "ovsdb://HOST1",
           "ovsdb:connection-info": {
             "remote-ip": "{{OVS-HOST-IP}}",
             "remote-port": 6640
           }
         }
       ]
     }
   ]
 }

As a result of the OVSDB node configuration being added to the configuration MD-SAL, the OVSDB
southbound plugin will attempt to connect with the specified OVS host.  If the connection is
successful, the plugin will connect to the OVS host as an OVSDB manager, query the schemas and
databases supported by the OVS host, and register to monitor changes made to the OVSDB tables
on the OVS host.  It will also set an external id key and value in the external-ids column
of the Open_vSwtich table of the OVS host which identifies the MD-SAL instance identifier
of the OVSDB node.  This ensures that the OVSDB node will use the same 'node-id' in both the
configuration and operational MD-SAL.

 "opendaylight-iid" = "instance identifier of OVSDB node in the MD-SAL"

When the OVS host sends the OVSDB southbound plugin the first update message after the monitoring has
been established, the plugin will populate the operational MD-SAL with the information it
receives from the OVS host.

Query the operational MD-SAL for the OVSDB topology.

HTTP GET:

 http://{{CONTROLLER-IP}}:8181/restconf/operational/network-topology:network-topology/topology/ovsdb:1/

Result Body:

 {
   "topology": [
     {
       "topology-id": "ovsdb:1",
       "node": [
         {
           "node-id": "ovsdb://HOST1",
           "ovsdb:openvswitch-external-ids": [
             {
               "external-id-key": "opendaylight-iid",
               "external-id-value": "/network-topology:network-topology/network-topology:topology[network-topology:topology-id='ovsdb:1']/network-topology:node[network-topology:node-id='ovsdb://HOST1']"
             }
           ],
           "ovsdb:connection-info": {
             "local-ip": "{{CONTROLLER-IP}}",
             "remote-port": 6640,
             "remote-ip": "{{OVS-HOST-IP}}",
             "local-port": 39042
           },
           "ovsdb:ovs-version": "2.3.1-git4750c96",
           "ovsdb:manager-entry": [
             {
               "target": "ptcp:6640",
               "connected": true,
               "number_of_connections": 1
             }
           ]
         }
       ]
     }
   ]
 }


To disconnect an active connection, just delete the configuration MD-SAL entry.

HTTP DELETE:

 http://{{CONTROLLER-IP}}:8181/restconf/config/network-topology:network-topology/topology/ovsdb:1/node/ovsdb:%2F%2FHOST1

Note in the above example, that '/' characters which are part of the 'node-id' are specified in hexadecimal format as "%2F".

===== Passive Connection to OVS Hosts

A passive connection is when the OVS host initiates the connection to
the OVSDB southbound plugin.  This happens when the OVS host is configured to connect
to the OVSDB southbound plugin.
The OVS host is configured with the following command:

 sudo ovs-vsctl set-manager tcp:<CONTROLLER-IP>:6640

The OVSDB southbound plugin is configured to listen for OVSDB connections
on TCP port 6640.  This value can be changed by editing the "./karaf/target/assembly/etc/custom.properties"
file and changing the value of the "ovsdb.listenPort" attribute.

When a passive connection is made, the OVSDB node will appear first in the operational MD-SAL.
If the Open_vSwitch table does not contain an external-ids value of 'opendaylight-iid', then
the 'node-id' of the new OVSDB node will be created in the format:

 "ovsdb://uuid/<actual UUID value>"

If there an 'opendaylight-iid' value was already present in the external-ids column, then the
instance identifier defined there will be used to create the 'node-id' instead.

Query the operational MD-SAL for an OVSDB node after a passive connection.

HTTP GET:

 http://{{CONTROLLER-IP}}:8181/restconf/operational/network-topology:network-topology/topology/ovsdb:1/

Result Body:

 {
   "topology": [
     {
       "topology-id": "ovsdb:1",
       "node": [
         {
           "node-id": "ovsdb://uuid/163724f4-6a70-428a-a8a0-63b2a21f12dd",
           "ovsdb:openvswitch-external-ids": [
             {
               "external-id-key": "system-id",
               "external-id-value": "ecf160af-e78c-4f6b-a005-83a6baa5c979"
             }
           ],
           "ovsdb:connection-info": {
             "local-ip": "{{CONTROLLER-IP}}",
             "remote-port": 46731,
             "remote-ip": "{{OVS-HOST-IP}}",
             "local-port": 6640
           },
           "ovsdb:ovs-version": "2.3.1-git4750c96",
           "ovsdb:manager-entry": [
             {
               "target": "tcp:10.11.21.7:6640",
               "connected": true,
               "number_of_connections": 1
             }
           ]
         }
       ]
     }
   ]
 }

Take note of the 'node-id' that was created in this case.

===== Manage Bridges

The OVSDB southbound plugin can be used to manage bridges on an OVS host.

This example shows how to add a bridge to the OVSDB node 'ovsdb://HOST1'.

HTTP PUT:

 http://{{CONTROLLER-IP}}:8181/restconf/config/network-topology:network-topology/topology/ovsdb:1/node/ovsdb:%2F%2FHOST1%2Fbridge%2Fbrtest

Body:

 {
   "network-topology:node": [
     {
       "node-id": "ovsdb://HOST1/bridge/brtest",
       "ovsdb:bridge-name": "brtest",
       "ovsdb:protocol-entry": [
         {
           "protocol": "ovsdb:ovsdb-bridge-protocol-openflow-13"
         }
       ],
       "ovsdb:managed-by": "/network-topology:network-topology/network-topology:topology[network-topology:topology-id='ovsdb:1']/network-topology:node[network-topology:node-id='ovsdb://HOST1']"
     }
   ]
 }

Notice that the 'ovsdb:managed-by' attribute is specified in the command.  This indicates the association of the new bridge node with its OVSDB node.

Bridges can be updated.  In the following example, Opendaylight is configured to be the Openflow controller for the bridge.

HTTP PUT:

 http://{{CONTROLLER-IP}}:8181/restconf/config/network-topology:network-topology/topology/ovsdb:1/node/ovsdb:%2F%2FHOST1%2Fbridge%2Fbrtest

Body:

 {
   "network-topology:node": [
         {
           "node-id": "ovsdb://HOST1/bridge/brtest",
              "ovsdb:bridge-name": "brtest",
               "ovsdb:controller-entry": [
                 {
                   "target": "tcp:{{CONTROLLER-IP}}:6653"
                 }
               ],
              "ovsdb:managed-by": "/network-topology:network-topology/network-topology:topology[network-topology:topology-id='ovsdb:1']/network-topology:node[network-topology:node-id='ovsdb://HOST1']"
         }
     ]
 }

If the Opendaylight Openflow plugin is installed, then checking on the OVS host will show that Opendaylight has successfully connected as the controller for the bridge.

 $ sudo ovs-vsctl show
     Manager "ptcp:6640"
         is_connected: true
     Bridge brtest
         Controller "tcp:{{CONTROLLER-IP}}:6653"
             is_connected: true
         Port brtest
             Interface brtest
                 type: internal
     ovs_version: "2.3.1-git4750c96"

Query the operational MD-SAL to see how the bridge appears.



Result Body:

 {
   "node": [
     {
       "node-id": "ovsdb://HOST1/bridge/brtest",
       "ovsdb:bridge-name": "brtest",
       "ovsdb:datapath-type": "ovsdb:datapath-type-system",
       "ovsdb:datapath-id": "00:00:da:e9:0c:08:2d:45",
       "ovsdb:managed-by": "/network-topology:network-topology/network-topology:topology[network-topology:topology-id='ovsdb:1']/network-topology:node[network-topology:node-id='ovsdb://HOST1']",
       "ovsdb:bridge-external-ids": [
         {
           "bridge-external-id-key": "opendaylight-iid",
           "bridge-external-id-value": "/network-topology:network-topology/network-topology:topology[network-topology:topology-id='ovsdb:1']/network-topology:node[network-topology:node-id='ovsdb://HOST1/bridge/brtest']"
         }
       ],
       "ovsdb:protocol-entry": [
         {
           "protocol": "ovsdb:ovsdb-bridge-protocol-openflow-13"
         }
       ],
       "ovsdb:bridge-uuid": "080ce9da-101e-452d-94cd-ee8bef8a4b69",
       "ovsdb:controller-entry": [
         {
           "target": "tcp:10.11.21.7:6653",
           "is-connected": true,
           "controller-uuid": "c39b1262-0876-4613-8bfd-c67eec1a991b"
         }
       ],
       "termination-point": [
         {
           "tp-id": "brtest",
           "ovsdb:port-uuid": "c808ae8d-7af2-4323-83c1-e397696dc9c8",
           "ovsdb:ofport": 65534,
           "ovsdb:interface-type": "ovsdb:interface-type-internal",
           "ovsdb:interface-uuid": "49e9417f-4479-4ede-8faf-7c873b8c0413",
           "ovsdb:name": "brtest"
         }
       ]
     }
   ]
 }

Notice that just like with the OVSDB node, an 'opendaylight-iid' has been added to the external-ids column of the bridge since it was created via the configuration MD-SAL.


A bridge node may be deleted as well.

HTTP DELETE:

 http://{{CONTROLLER-IP}}:8181/restconf/config/network-topology:network-topology/topology/ovsdb:1/node/ovsdb:%2F%2FHOST1%2Fbridge%2Fbrtest

===== Manage Ports

Similarly, ports may be managed by the OVSDB southbound plugin.

This example illustrates how a port and various attributes may be created on a bridge.

HTTP PUT:

 http://{{CONTROLLER-IP}}:8181/restconf/config/network-topology:network-topology/topology/ovsdb:1/node/ovsdb:%2F%2FHOST1%2Fbridge%2Fbrtest/termination-point/testport/

Body:

 {
   "network-topology:termination-point": [
     {
       "ovsdb:options": [
         {
           "ovsdb:option": "remote_ip",
           "ovsdb:value" : "10.10.14.11"
         }
       ],
       "ovsdb:name": "testport",
       "ovsdb:interface-type": "ovsdb:interface-type-vxlan",
       "tp-id": "testport",
       "vlan-tag": "1",
       "trunks": [
         {
           "trunk": "5"
         }
       ],
       "vlan-mode":"access"
     }
   ]
 }


Ports can be updated - add another VLAN trunk.

HTTP PUT:

 http://{{CONTROLLER-IP}}:8181/restconf/config/network-topology:network-topology/topology/ovsdb:1/node/ovsdb:%2F%2FHOST1%2Fbridge%2Fbrtest/termination-point/testport/

Body:

 {
   "network-topology:termination-point": [
     {
       "ovsdb:name": "testport",
       "tp-id": "testport",
       "trunks": [
         {
           "trunk": "5"
         },
         {
           "trunk": "500"
         }
       ]
     }
   ]
 }

Query the operational MD-SAL for the port.

HTTP GET:

 http://{{CONTROLLER-IP}}:8181/restconf/operational/network-topology:network-topology/topology/ovsdb:1/node/ovsdb:%2F%2FHOST1%2Fbridge%2Fbrtest/termination-point/testport/

Result Body:

 {
   "termination-point": [
     {
       "tp-id": "testport",
       "ovsdb:port-uuid": "b1262110-2a4f-4442-b0df-84faf145488d",
       "ovsdb:options": [
         {
           "option": "remote_ip",
           "value": "10.10.14.11"
         }
       ],
       "ovsdb:port-external-ids": [
         {
           "external-id-key": "opendaylight-iid",
           "external-id-value": "/network-topology:network-topology/network-topology:topology[network-topology:topology-id='ovsdb:1']/network-topology:node[network-topology:node-id='ovsdb://HOST1/bridge/brtest']/network-topology:termination-point[network-topology:tp-id='testport']"
         }
       ],
       "ovsdb:interface-type": "ovsdb:interface-type-vxlan",
       "ovsdb:trunks": [
         {
           "trunk": 5
         },
         {
           "trunk": 500
         }
       ],
       "ovsdb:vlan-mode": "access",
       "ovsdb:vlan-tag": 1,
       "ovsdb:interface-uuid": "7cec653b-f407-45a8-baec-7eb36b6791c9",
       "ovsdb:name": "testport",
       "ovsdb:ofport": 1
     }
   ]
 }

Remember that the OVSDB YANG model includes both OVSDB port and interface table attributes in the termination-point augmentation.
Both kinds of attributes can be seen in the examples above.  Again, note the creation of an 'opendaylight-iid' value in the external-ids column of the port table.

Delete a port.

HTTP DELETE:

 http://{{CONTROLLER-IP}}:8181/restconf/config/network-topology:network-topology/topology/ovsdb:1/node/ovsdb:%2F%2FHOST1%2Fbridge%2Fbrtest2/termination-point/testport/




===== Overview of Qos and Queue
The OVSDB plugin provides the capability of managing the Qos
and Queue tables on an OVS host with Opendaylight configured
as the OVSDB manager.

====== Qos and Queue Tables in OVSDB
The OVSDB includes a Qos and Queue table.  Unlike most of the other tables
in the OVSDB, except the Open_vSwitch table, the Qos and Queue tables are
"root set" tables, which means that entries, or rows, in these tables are
not automatically deleted if they can not be reached directly or indirectly
from the Open_vSwitch table.  This means that Qos entries can exist and be
managed independently of whether or not they are referenced in a Port entry.
Similarly, Queue entries can be managed independently of whether or not they are
referenced by a Qos entry.


====== Modelling of Qos and Queue Tables in Opendaylight MD-SAL

Since the Qos and Queue tables are "root set" tables, they are modeled
in the Opendaylight MD-SAl as lists which are part of the attributes
of the OVSDB Node model.

The MD-SAL Qos and Queue models have an additonal identifier attribute per
entry (e.g. "qos-id" or "queue-id") which is not present
in the OVSDB schema. This identifier is used by the MD-SAL as a key for referencing
the entry.  If the entry is created originally from the
configuration MD-SAL, then the value of the identifier is whatever is specified
by the configuration.  If the entry is created on the OVSDB node and received
by Opendaylight in an operational update, then the id will be created in
the following format.

 "queue-id": "queue://<UUID>"
 "qos-id": "qos://<UUID>"

The UUID in the above identifiers is the actual UUID of the entry in the
OVSDB database.

When the Qos or Queue entry is created by the configuration MD-SAL, the
identifier will be configured as part of the external-ids column of the
entry.  This will ensure that the corresponding entry that is created
in the operational MD-SAL uses the same identifier.

 "queues-external-ids": [
   {
     "queues-external-id-key": "opendaylight-queue-id",
     "queues-external-id-value": "QUEUE-1"
   }
 ]

See more in the examples that follow in this section.

The Qos schema in OVSDB currently defines two types of Qos entries.

* linux-htb
* linux-hfsc

These Qos types are defined in the Qos model.  Additional types will
need to be added to the model in order to be supported.  See the examples
that folow for how the Qos type is specified in the model.

Qos entries can be configured with addtional attritubes such as "max-rate".
These are configured via the 'other-config' column of the Qos entry.  Refer
to OVSDB schema (in the reference section below) for all of the relevant
attributes that can be configured.  The examples in the rest of this section
will demonstrate how the other-config column may be configured.

Similarly, the Queue entries may be configured with additional attributes
via the other-config column.

===== Managing Qos and Queues via Configuration MD-SAL
This section will show some examples on how to manage Qos and
Queue entries via the configuration MD-SAL.  The examples will
be illustrated by using RESTCONF (see
https://github.com/opendaylight/ovsdb/blob/stable/beryllium/resources/commons/Qos-and-Queue-Collection.json.postman_collection[Qos and Queue Postman Collection] ).

A pre-requisite for managing Qos and Queue entries is that the
OVS host must be present in the configuration MD-SAL.

For the following examples, the following OVS host is configured.

HTTP POST:

 http://{{CONTROLLER-IP}}:8181/restconf/config/network-topology:network-topology/topology/ovsdb:1/

Body:

 {
   "node": [
     {
       "node-id": "ovsdb:HOST1",
       "connection-info": {
         "ovsdb:remote-ip": "{{OVS-HOST-IP}}",
         "ovsdb:remote-port": "{{OVS-HOST-OVSDB-PORT}}"
       }
     }
   ]
 }

Where

 {{CONTROLLER-IP}}          is the IP address of the Opendaylight controller
 {{OVS-HOST}}               is the IP address of the OVS host
 {{OVS-HOST-OVSDB-PORT}}    is the TCP port of the OVSDB server on the OVS host (e.g. 6640)

This command creates an OVSDB node with the node-id "ovsdb:HOST1".  This OVSDB node will be used in the following
examples.

Qos and Queue entries can be created and managed without a port, but ultimately, Qos entries are
associated with a port in order to use them.  For the following examples a test bridge and port will
be created.

Create the test bridge.

HTTP PUT

 http://{{CONTROLLER-IP}}:8181/restconf/config/network-topology:network-topology/topology/ovsdb:1/node/ovsdb:HOST1%2Fbridge%2Fbr-test

Body:

 {
   "network-topology:node": [
     {
       "node-id": "ovsdb:HOST1/bridge/br-test",
       "ovsdb:bridge-name": "br-test",
       "ovsdb:managed-by": "/network-topology:network-topology/network-topology:topology[network-topology:topology-id='ovsdb:1']/network-topology:node[network-topology:node-id='ovsdb:HOST1']"
     }
   ]
 }

Create the test port (which is modeled as a termination point in the Opendaylight MD-SAL).

HTTP PUT:

 http://{{CONTROLLER-IP}}:8181/restconf/config/network-topology:network-topology/topology/ovsdb:1/node/ovsdb:HOST1%2Fbridge%2Fbr-test/termination-point/testport/

Body:

 {
   "network-topology:termination-point": [
     {
       "ovsdb:name": "testport",
       "tp-id": "testport"
     }
   ]
 }

If all of the previous steps were successful, a query of the operational MD-SAL should look something like the following results.  This indicates that the configuration commands have been successfully instantiated on the OVS host.

HTTP GET:

 http://{{CONTROLLER-IP}}:8181/restconf/operational/network-topology:network-topology/topology/ovsdb:1/node/ovsdb:HOST1%2Fbridge%2Fbr-test

Result Body:

 {
   "node": [
     {
       "node-id": "ovsdb:HOST1/bridge/br-test",
       "ovsdb:bridge-name": "br-test",
       "ovsdb:datapath-type": "ovsdb:datapath-type-system",
       "ovsdb:managed-by": "/network-topology:network-topology/network-topology:topology[network-topology:topology-id='ovsdb:1']/network-topology:node[network-topology:node-id='ovsdb:HOST1']",
       "ovsdb:datapath-id": "00:00:8e:5d:22:3d:09:49",
       "ovsdb:bridge-external-ids": [
         {
           "bridge-external-id-key": "opendaylight-iid",
           "bridge-external-id-value": "/network-topology:network-topology/network-topology:topology[network-topology:topology-id='ovsdb:1']/network-topology:node[network-topology:node-id='ovsdb:HOST1/bridge/br-test']"
         }
       ],
       "ovsdb:bridge-uuid": "3d225d8d-d060-4909-93ef-6f4db58ef7cc",
       "termination-point": [
         {
           "tp-id": "br=-est",
           "ovsdb:port-uuid": "f85f7aa7-4956-40e4-9c94-e6ca2d5cd254",
           "ovsdb:ofport": 65534,
           "ovsdb:interface-type": "ovsdb:interface-type-internal",
           "ovsdb:interface-uuid": "29ff3692-6ed4-4ad7-a077-1edc277ecb1a",
           "ovsdb:name": "br-test"
         },
         {
           "tp-id": "testport",
           "ovsdb:port-uuid": "aa79a8e2-147f-403a-9fa9-6ee5ec276f08",
           "ovsdb:port-external-ids": [
             {
               "external-id-key": "opendaylight-iid",
               "external-id-value": "/network-topology:network-topology/network-topology:topology[network-topology:topology-id='ovsdb:1']/network-topology:node[network-topology:node-id='ovsdb:HOST1/bridge/br-test']/network-topology:termination-point[network-topology:tp-id='testport']"
             }
           ],
           "ovsdb:interface-uuid": "e96f282e-882c-41dd-a870-80e6b29136ac",
           "ovsdb:name": "testport"
         }
       ]
     }
   ]
 }

====== Create Queue
Create a new Queue in the configuration MD-SAL.

HTTP PUT:

 http://{{CONTROLLER-IP}}:8181/restconf/config/network-topology:network-topology/topology/ovsdb:1/node/ovsdb:HOST1/ovsdb:queues/QUEUE-1/

Body:

 {
   "ovsdb:queues": [
     {
       "queue-id": "QUEUE-1",
       "dscp": 25,
       "queues-other-config": [
         {
           "queue-other-config-key": "max-rate",
           "queue-other-config-value": "3600000"
         }
       ]
     }
   ]
 }


====== Query Queue
Now query the operational MD-SAL for the Queue entry.

HTTP GET:

 http://{{CONTROLLER-IP}}:8181/restconf/operational/network-topology:network-topology/topology/ovsdb:1/node/ovsdb:HOST1/ovsdb:queues/QUEUE-1/

Result Body:

 {
   "ovsdb:queues": [
     {
       "queue-id": "QUEUE-1",
       "queues-other-config": [
         {
           "queue-other-config-key": "max-rate",
           "queue-other-config-value": "3600000"
         }
       ],
       "queues-external-ids": [
         {
           "queues-external-id-key": "opendaylight-queue-id",
           "queues-external-id-value": "QUEUE-1"
         }
       ],
       "queue-uuid": "83640357-3596-4877-9527-b472aa854d69",
       "dscp": 25
     }
   ]
 }

====== Create Qos

Create a Qos entry.  Note that the UUID of the Queue entry, obtained by querying the operational MD-SAL of the Queue entry, is
specified in the queue-list of the Qos entry.  Queue entries may be added to the Qos entry at the creation of the Qos entry, or
by a subsequent update to the Qos entry.

HTTP PUT:

 http://{{CONTROLLER-IP}}:8181/restconf/config/network-topology:network-topology/topology/ovsdb:1/node/ovsdb:HOST1/ovsdb:qos-entries/QOS-1/

Body:

 {
   "ovsdb:qos-entries": [
     {
       "qos-id": "QOS-1",
       "qos-type": "ovsdb:qos-type-linux-htb",
       "qos-other-config": [
         {
           "other-config-key": "max-rate",
           "other-config-value": "4400000"
         }
       ],
       "queue-list": [
         {
           "queue-number": "0",
           "queue-uuid": "83640357-3596-4877-9527-b472aa854d69"
         }
       ]
     }
   ]
 }

====== Query Qos

Query the operational MD-SAL for the Qos entry.

HTTP GET:

 http://{{CONTROLLER-IP}}:8181/restconf/operational/network-topology:network-topology/topology/ovsdb:1/node/ovsdb:HOST1/ovsdb:qos-entries/QOS-1/

Result Body:

 {
   "ovsdb:qos-entries": [
     {
       "qos-id": "QOS-1",
       "qos-other-config": [
         {
           "other-config-key": "max-rate",
           "other-config-value": "4400000"
         }
       ],
       "queue-list": [
         {
           "queue-number": 0,
           "queue-uuid": "83640357-3596-4877-9527-b472aa854d69"
         }
       ],
       "qos-type": "ovsdb:qos-type-linux-htb",
       "qos-external-ids": [
         {
           "qos-external-id-key": "opendaylight-qos-id",
           "qos-external-id-value": "QOS-1"
         }
       ],
       "qos-uuid": "90ba9c60-3aac-499d-9be7-555f19a6bb31"
     }
   ]
 }

====== Add Qos to a Port
Update the termination point entry to include the UUID of the Qos entry, obtained by querying the operational MD-SAL, to associate a Qos entry with a port.

HTTP PUT:

 http://{{CONTROLLER-IP}}:8181/restconf/config/network-topology:network-topology/topology/ovsdb:1/node/ovsdb:HOST1%2Fbridge%2Fbr-test/termination-point/testport/

Body:

 {
   "network-topology:termination-point": [
     {
       "ovsdb:name": "testport",
       "tp-id": "testport",
       "qos": "90ba9c60-3aac-499d-9be7-555f19a6bb31"
     }
   ]
 }

====== Query the Port
Query the operational MD-SAL to see how the Qos entry appears in the termination point model.

HTTP GET:

 http://{{CONTROLLER-IP}}:8181/restconf/operational/network-topology:network-topology/topology/ovsdb:1/node/ovsdb:HOST1%2Fbridge%2Fbr-test/termination-point/testport/

Result Body:

 {
   "termination-point": [
     {
       "tp-id": "testport",
       "ovsdb:port-uuid": "aa79a8e2-147f-403a-9fa9-6ee5ec276f08",
       "ovsdb:port-external-ids": [
         {
           "external-id-key": "opendaylight-iid",
           "external-id-value": "/network-topology:network-topology/network-topology:topology[network-topology:topology-id='ovsdb:1']/network-topology:node[network-topology:node-id='ovsdb:HOST1/bridge/br-test']/network-topology:termination-point[network-topology:tp-id='testport']"
         }
       ],
       "ovsdb:qos": "90ba9c60-3aac-499d-9be7-555f19a6bb31",
       "ovsdb:interface-uuid": "e96f282e-882c-41dd-a870-80e6b29136ac",
       "ovsdb:name": "testport"
     }
   ]
 }


====== Query the OVSDB Node
Query the operational MD-SAL for the OVS host to see how the Qos and Queue entries appear as lists in the OVS Node model.

HTTP GET:

 http://{{CONTROLLER-IP}}:8181/restconf/operational/network-topology:network-topology/topology/ovsdb:1/node/ovsdb:HOST1/

Result Body (edited to only show information relevant to the Qos and Queue entries) :

 {
   "node": [
     {
       "node-id": "ovsdb:HOST1",
       <content edited out>
       "ovsdb:queues": [
         {
           "queue-id": "QUEUE-1",
           "queues-other-config": [
             {
               "queue-other-config-key": "max-rate",
               "queue-other-config-value": "3600000"
             }
           ],
           "queues-external-ids": [
             {
               "queues-external-id-key": "opendaylight-queue-id",
               "queues-external-id-value": "QUEUE-1"
             }
           ],
           "queue-uuid": "83640357-3596-4877-9527-b472aa854d69",
           "dscp": 25
         }
       ],
       "ovsdb:qos-entries": [
         {
           "qos-id": "QOS-1",
           "qos-other-config": [
             {
               "other-config-key": "max-rate",
               "other-config-value": "4400000"
             }
           ],
           "queue-list": [
             {
               "queue-number": 0,
               "queue-uuid": "83640357-3596-4877-9527-b472aa854d69"
             }
           ],
           "qos-type": "ovsdb:qos-type-linux-htb",
           "qos-external-ids": [
             {
               "qos-external-id-key": "opendaylight-qos-id",
               "qos-external-id-value": "QOS-1"
             }
           ],
           "qos-uuid": "90ba9c60-3aac-499d-9be7-555f19a6bb31"
         }
       ]
       <content edited out>
     }
   ]
 }


====== Remove Qos from a Port
This example removes a Qos entry from the termination point and associated port.  Note that this is a PUT command on the termination point with the
Qos attribute absent.  Other attributes of the termination point should be included in the body of the command so that they are not inadvertantly removed.

HTTP PUT:

 http://{{CONTROLLER-IP}}:8181/restconf/config/network-topology:network-topology/topology/ovsdb:1/node/ovsdb:HOST1%2Fbridge%2Fbr-test/termination-point/testport/

Body:

 {
   "network-topology:termination-point": [
     {
       "ovsdb:name": "testport",
       "tp-id": "testport"
     }
   ]
 }

====== Remove a Queue from Qos

This example removes the specific Queue entry from the queue list in the Qos entry.  The queue entry is specified by the queue number, which is "0" in this example.

HTTP DELETE:

 http://{{CONTROLLER-IP}}:8181/restconf/config/network-topology:network-topology/topology/ovsdb:1/node/ovsdb:HOST1/ovsdb:qos-entries/QOS-1/queue-list/0/

====== Remove Queue
Once all references to a specific queue entry have been removed from Qos entries, the Queue itself can be removed.

HTTP DELETE:

 http://{{CONTROLLER-IP}}:8181/restconf/config/network-topology:network-topology/topology/ovsdb:1/node/ovsdb:HOST1/ovsdb:queues/QUEUE-1/

====== Remove Qos
The Qos entry may be removed when it is no longer referenced by any ports.

HTTP DELETE:

 http://{{CONTROLLER-IP}}:8181/restconf/config/network-topology:network-topology/topology/ovsdb:1/node/ovsdb:HOST1/ovsdb:qos-entries/QOS-1/


===== References
http://openvswitch.org/ovs-vswitchd.conf.db.5.pdf[Openvswitch schema]

https://github.com/opendaylight/ovsdb/blob/stable/beryllium/resources/commons[OVSDB and Netvirt Postman Collection]

