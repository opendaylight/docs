==== Overview
This section is for Application Developers and Network Administrators
who are looking to integrate Group Based Policy with OpenStack. 

To enable the *GBP* Neutron Mapper feature, at the karaf console:

 feature:install odl-groupbasedpolicy-neutronmapper

Neutron Mapper has the following dependencies that are automatically loaded:

 odl-neutron-service

Neutron Northbound implementing REST API used by OpenStack

 odl-groupbasedpolicy-base

Base *GBP* feature set, such as policy resolution, data model etc.

 odl-groupbasedpolicy-ofoverlay

For Lithium, *GBP* has one renderer, hence this is loaded by default.

REST calls from OpenStack Neutron are by the Neutron NorthBound project.

*GBP* provides the implementation of the http://developer.openstack.org/api-ref-networking-v2.html[Neutron V2.0 API].

==== Features

List of supported Neutron entities:

* Port
* Network
** Standard Internal
** External provider L2/L3 network
* Subnet
* Security-groups
* Routers
** Distributed functionality with local routing per compute
** External gateway access per compute node (dedicated port required) 
** Multiple routers per tenant
* FloatingIP NAT
* IPv4/IPv6 support

The mapping of Neutron entities to *GBP* entities is as follows:

*Neutron Port*

.Neutron Port
image::groupbasedpolicy/neutronmapper-gbp-mapping-port.png[width=300]

The Neutron port is mapped to an endpoint. 

The current implementation supports one IP address per Neutron port.

An endpoint and L3-endpoint belong to multiple EndpointGroups if the Neutron port is in multiple Neutron Security Groups. 

The key for endpoint is L2-bridge-domain obtained as the parent of L2-flood-domain representing Neutron network. The MAC address is from the Neutron port.
An L3-endpoint is created based on L3-context (the parent of the L2-bridge-domain) and IP address of Neutron Port. 

*Neutron Network*

.Neutron Network
image::groupbasedpolicy/neutronmapper-gbp-mapping-network.png[width=300]

NOTE: _alagalah reword in morning_ Neutron network is mapped to multiple *GBP* entities. The first mapping is to L2-flood-domain because Neutron network is one broadcast domain. The second mapping is to L2-bridge-domain where this L2-bridge-domain is the parent of L2-flood-domain. Neutron network is unique L2 address space therefore is also represented as L2-bridge-domain. The third mapping is to L3-context whereas represents separated L3 address space. The L3-context is the parent of L2-bridge-domain. The mapping and relation between *GBP* entities are illustrated on picture below.

*Neutron Subnet*

.Neutron Subnet
image::groupbasedpolicy/neutronmapper-gbp-mapping-subnet.png[width=300]

Neutron subnet is associated with a Neutron network. The Neutron subnet is mapped to a *GBP* subnet where the parent of the subnet is L2-flood-domain representing the Neutron network. 

*Neutron Security Group*

.Neutron Security Group and Rules
image::groupbasedpolicy/neutronmapper-gbp-mapping-securitygroup.png[width=300]

*GBP* entity representing Neutron security-group is EndpointGroup. 

*Infrastructure EndpointGroups*

Neutron-mapper automatically creates EndpointGroups to manage key infrastructure items such as:

* DHCP EndpointGroup - contains endpoints representing Neutron DHCP ports
* Router EndpointGroup - contains endpoints representing Neutron router interfaces
* External EndpointGroup - holds L3-endpoints representing Neutron router gateway ports, also associated with FloatingIP ports.

*Neutron Security Group Rules*

This mapping is most complicated among all others because Neutron security-group-rules are mapped to contracts with clauses, 
subjects, rules, action-refs, classifier-refs, etc. 
Contracts are used between endpoint groups representing Neutron Security Groups. 
For simplification it is important to note that Neutron security-group-rules are similar to a *GBP* rule containing:

* classifier with direction
* action of *allow*.


*Neutron Routers*

.Neutron Router
image::groupbasedpolicy/neutronmapper-gbp-mapping-router.png[width=300]

Neutron router is represented as a L3-context. This treats a router as a Layer3 namespace, and hence every network attached to it a part
of that Layer3 namespace. This allows for multiple routers per tenant with complete isolation.
The mapping of the router to an endpoint represents the router's interface or gateway port.
The mapping to an EndpointGroup represents the internal infrastructure EndpointGroups created by the *GBP* Neutron Mapper

When a Neutron router interface is attached to a network/subnet, that network/subnet and its associated endpoints or Neutron Ports are seamlessly added to the namespace.

*Neutron FloatingIP*

When associated with a Neutron Port, this leverages the <<OfOverlay,OfOverlay>> renderer's NAT capabilities.

A dedicated _external_ interface on each Nova compute host allows for disitributed external access. Each Nova instance associated with a 
FloatingIP address can access the external network directly without having to route via the Neutron controller, or having to enable any form
of Neutron distributed routing functionality.

Assuming the gateway provisioned in the Neutron Subnet command for the external network is reachable, the combination of *GBP* Neutron Mapper and 
<<OfOverlay,OfOverlay renderer>> will automatically ARP for this default gateway, requiring no user intervention.


*Troubleshooting within GBP*

Logging level for the mapping functionality can be set for package org.opendaylight.groupbasedpolicy.neutron.mapper. An example of enabling TRACE logging level on karaf console:

 log:set TRACE org.opendaylight.groupbasedpolicy.neutron.mapper

==== Configuring GBP Neutron

No intervention passed initial OpenStack setup is required by the user.

More information about configuration can be found in our DevStack demo environment on the https://wiki.opendaylight.org/view/Group_Based_Policy_(GBP)[*GBP* wiki].

==== Administering or Managing GBP Neutron

For consistencies sake, all provisioning should be performed via the Neutron API. (CLI or Horizon).

The mapped policies can be augmented via the *GBP* <<UX,UX>>, to:

* Enable <<SFC,Service Function Chaining>>
* Add endpoints from outside of Neutron i.e. VMs/containers not provisioned in OpenStack
* Augment policies/contracts derived from Security Group Rules
* Overlay additional contracts or groupings

==== Tutorials

A DevStack demo environment can be found on the https://wiki.opendaylight.org/view/Group_Based_Policy_(GBP)[*GBP* wiki].
