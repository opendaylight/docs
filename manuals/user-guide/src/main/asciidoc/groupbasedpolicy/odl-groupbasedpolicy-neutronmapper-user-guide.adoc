==== Overview
This section is for Application Developers and Network Administrators
who are looking to integrate Group Based Policy with OpenStack. 

To enable the *GBP* Neutron Mapper feature, at the karaf console:

 feature:install odl-groupbasedpolicy-neutronmapper

Neutron Mapper has the following dependencies that are automatically loaded:
 odl-neutron-service

Neutron Northbound implementing REST API used by OpenStack
 odl-groupbasedpolicy-base

Base *GBP* feature set, such as policy resolution, data model etc.

 odl-groupbasedpolicy-ofoverlay

For Lithium, *GBP* has one renderer, hence this is loaded by default.

REST calls from OpenStack Neutron are by the Neutron NorthBound project.

*GBP* provides the implementation of the http://developer.openstack.org/api-ref-networking-v2.html[Neutron V2.0 API].

==== Features


List of supported Neutron entities:
* Port
* Network
** Standard Internal
** External provider L2/L3 network
* Subnet
* Security-groups
* Routers
** Distributed functionality with local routing per compute
** External gateway access per compute node (dedicated port required) 
** Multiple routers per tenant
* FloatingIP NAT

The mapping of Neutron entities to *GBP* entities is as follows:

Neutron network



Mapping function
Neutron network
Neutron network is mapped to multiple GBP entities. The first mapping is to L2-flood-domain because Neutron network is one broadcast domain. The second mapping is to L2-bridge-domain where this L2-bridge-domain is the parent of L2-flood-domain. Neutron network is unique L2 address space therefore is also represented as L2-bridge-domain. The third mapping is to L3-context whereas represents separated L3 address space. The L3-context is the parent of L2-bridge-domain. The mapping and relation between GBP entities are illustrated on picture below.

Neutron subnet
Neutron subnet is always located in Neutron network so the Neutron subnet is mapped to GBP subnet where the parent of the subnet is L2-flood-domain representing the Neutron network. The picture below shows mapping after Neutron subnet was added to Neutron network.

Neutron security-group
GBP entity representing Neutron security-group is endpoint-group. This mapping is straightforward and do not need any further explanation. Neutron-mapper also creates endpoint-groups which are not created in Openstack but are important in GBP in order to ensure expected behavior. This automatically created groups are:
DHCP endpoint-group - contains endpoints representing Neutron DHCP ports
Router endpoint-group - contains endpoints representing Neutron router interfaces
External endpoint-group - holds L3-endpoints representing Neutron router gateway ports

Neutron security-group-rule
This mapping is most complicated among all others because Neutron security-group-rules are mapped to contracts with clauses, subjects, rules, action-refs, classifier-refs, etc. Contracts are used between endpoint groups representing Neutron security-groups. For simplification is important to say that Neutron security-group-rule is most similar to GBP rule containing classifier-ref with direction and action-ref pointing to “allow”.

Neutron port
Basicly said Neutron port is an endpoint and L3-endpoint. The current implementation does not support Neutron port with multiple IP addresses. An endpoint and L3-endpoint belong to multiple endpoint-groups if Neutron port is in multiple Neutron security-groups. The key for endpoint is L2-bridge-domain obtained as the parent of L2-flood-domain representing Neutron network and MAC address from Neutron port. L3-endpoint is created based on L3-context (the parent of the L2-bridge-domain) and IP address of Neutron Port. Relation between endpoint, it’s key and Neutron port is shown on picture below.

Neutron router
Neutron router is represented as L3-context. When Neutron router interface is attached to Neutron subnet then L3-context is changed as parent for subnet where router port was created and is also changed for all L3-endpoints from that subnet.

Neutron floatingip

Logging hint
Logging level for the mapping functionality can be set for package org.opendaylight.groupbasedpolicy.neutron.mapper. An example of enabling TRACE logging level on karaf console:
log:set TRACE org.opendaylight.groupbasedpolicy.neutron.mapper
 

==== Group Based Policy Neutron Architecture


.Group Based Policy Neutron integration into ODL
image::groupbasedpolicy/gbp-neutron-mapper.png[width=500]

The OpenDaylight Neutron Service receives REST calls from
OpenStack's ML2 OpenDaylight Mechanism Driver. The rest calls
result in calls to the Group Based Policy Neutron Mapper, shown
in the figure as the "Neutron to GBP translator". This piece
maps Neutron API calls and parameters onto Group Based Policy
constructs.

.Group Based Policy Neutron to GBP Mappings
image::groupbasedpolicy/neutron-gbp-mappings.png[width=250]

NOTE: we should describe all of the functionality that we're
supporting -- floating IPs, L3 services, etc.

Provide information about feature components and how they work together.
Also include information about how the feature integrates with
OpenDaylight. An architecture diagram could help.

==== Configuring Group Based Policy Neutron
The integration with devstack currently uses the OpenFlow Overlay
renderer in Group Based Policy.  The renderer expects that the
appropriate infrastructure is in place. This means that DevStack
or any provisioning used for OpenStack needs stand up the following:

. Configure br-int on all nodes
. Configure br-ex on the controller node
. Set the OVSDB manager to the OpenDaylight controller

The neutron-mapper feature provides an integration with OVSDB, which
will automatically provision the tunnel ports needed and connect the
bridges to the controller.

Describe how to configure the feature or the project after installation.
Configuration information could include day-one activities for a project
such as configuring users, configuring clients/servers and so on.

==== Administering or Managing GBP Neutron
This section provides an example configuration
NOTE: should we describe configuration of local.conf?
Include related command reference or  operations that you could perform
using the feature. For example viewing network statistics, monitoring
the network,  generating reports, and so on.

NOTE:  Ensure that you create a step procedure whenever required and
avoid concepts.

For example:

.To configure L2switch components perform the following steps.
. Step 1:
. Step 2:
. Step 3:

==== Tutorials
<optional>
If there is only one tutorial, you skip the "Tutorials" section and
instead just lead with the single tutorial's name.

===== <Tutorial Name>
Ensure that the title starts with a gerund. For example using,
monitoring, creating, and so on.

====== Overview
An overview of the use case.

====== Prerequisites
Provide any prerequisite information, assumed knowledge, or environment
required to execute the use case.

====== Target Environment
Include any topology requirement for the use case. Ideally, provide
visual (abstract) layout of network diagrams and any other useful visual
aides.

====== Instructions
Use case could be a set of configuration procedures. Including
screenshots to help demonstrate what is happening is especially useful.
Ensure that you specify them separately. For example:

. *Setting up the VM*
To set up a VM perform the following steps.
.. Step 1
.. Step 2
.. Step 3

. *Installing the feature*
To install the feature perform the following steps.
.. Step 1
.. Step 2
.. Step 3

. *Configuring the environment*
To configure the system perform the following steps.
.. Step 1
.. Step 2
.. Step 3
