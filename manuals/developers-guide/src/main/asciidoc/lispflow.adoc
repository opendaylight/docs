== Lisp Flow Mapping

This chapter contains:

* <<OpenDaylight Locator ID Separation Protocol (LISP) Flow Mapping Overview>>
* <<Installing LISP Flow Mapping>>

=== OpenDaylight Locator ID Separation Protocol (LISP) Flow Mapping Overview

Locator ID Separation Protocol (LISP) is a technology that provides a flexible map-and-encap framework that can be used for overlay network applications such as data center network virtualization and Network Function Virtualization (NFV). 

LISP provides the following name spaces: 

* Endpoint Identifiers (EIDs)
* Routing Locators (RLOCs). 

In a virtualization environment EIDs can be viewed as virtual address space and RLOCs can be viewed as physical network address space. 

The LISP framework decouples network control plane from the forwarding plane by providing: 

* A data plane that specifies how the virtualized network addresses are encapsulated in addresses from the underlying physical network.
*  A control plane that stores the mapping of the virtual-to-physical address spaces and the associated forwarding policies and serves this information to the data plane on demand. 

Network programmability is achieved by programming forwarding policies such as transparent mobility, service chaining, and traffic engineering in the mapping system; where the data plane elements can fetch these policies on demand as new flows arrive. This chapter describes the LISP Flow Mapping project in OpenDaylight and how it can be used to enable advanced SDN and NFV use cases. 

LISP data plane Tunnel Routers are available at http://LISPmob.org/[LISPmob.org] in the open source community on the following platforms: 

* Linux 
* Android 
* OpenWRT 

For more details and support for LISP data plane software please visit http://LISPmob.org/[LISPmob.org].

==== LISP Flow Mapping Services

The LISP Flow Mapping service provides LISP Mapping System services. This includes LISP  Map-Server and LISP Map-Resolver services to store and serve mapping data to data plane nodes as well as to OpenDaylight applications. Mapping data can include mapping of virtual addresses to physical network address where the virtual nodes are reachable or hosted at. Mapping data can also include a variety of routing policies including traffic engineering and load balancing. To leverage this service, OpenDaylight applications and services can use the northbound REST API to define the mappings and policies in the LISP Mapping Service. Data plane devices capable of LISP control protocol can leverage this service through a southbound LISP plugin via the LISP control protocol (Map-Register, Map-Request, Map-Reply messages). 

The following figure depicts the described components:

.Architecture Overview

image::lispflow-arch-overview-helium.jpg["Architecture Overview", width=512]

The OpenDaylight LISP Mapping Service includes: 

* LISP Map Server 
* LISP Map Resolver 
* Southbound ODL plugin supporting LISP protocol 
* LISP Mapping Services northbound API 

==== LISP Architecture

The following figure shows the various LISP Flow Mapping modules. 

.LISP Mapping Service Internal Architecture

image::lispflow-technical-arch-overview-helium.jpg["LISP Mapping Service Internal Architecture", width=460]

A brief description of each module is as follows:

* *DAO*: This layer separates the LISP logic from the database, so that we can separate the map server and map resolver from the specific implementation of the DHT (Distributed Hash Table). Currently we have an implementation of this layer with the controller cluster service as a DHT, but it can be switched to any other DHT and you only need to implement the ILISPDAO interface. 
* *Map Server*: This module processes the adding or registration of keys and mappings. For a detailed specification of LISP Map Server, see http://tools.ietf.org/search/rfc6830[LISP]. 
* *Map Resolver*: This module receives and processes the mapping lookup queries and provides the mappings to requester. For a detailed specification of LISP Map Server, see http://tools.ietf.org/search/rfc6830[LISP].. 
* *Northbound API*: This is part of the ODL northbound API. This module enables defining key-EID associations as well as adding mapping information through the Map Server. Key-EID associations can also be queried via this API. The Northbound API also provides capability of querying the mapping information for an EID prefix. 
* *LISP Southbound Plugin*: This plugin enables data plane devices that support LISP control plane protocol (see LISP) to register and query mappings to the LISP Flow Mapping via the LISP control plane protocol. 
* *API*: The API module exposes the Map Server and Map Resolver capabilities via Java API. 

==== LISP APIs

The LISP Flow Mapping JAVA APIs and REST APIs are described below:

* https://wiki.opendaylight.org/view/OpenDaylight_LISP_Flow_Mapping:Java_API[JAVA APIs]
* https://wiki.opendaylight.org/view/OpenDaylight_LISP_Flow_Mapping:REST_API[REST APIS]

==== LISP Repository

The repository name for LISP is *LISPflowmapping (LISP Flow Mapping)*.

==== LISP Support

For support please contact the lispflowmapping project at: 

* Lisp Flow Mapping users mailing list: lispflowmapping-users@lists.opendaylight.org 

* Lisp Flow Mapping dev mailing list: lispflowmapping-dev@lists.opendaylight.org 

=== Installing LISP Flow Mapping

This chapter contains installation instructions for Locator ID Separation Protocol (LISP) provides guidelines for installation from the lispflowmapping repository.


==== Setting up Gerritt

Code reviews are enabled through Gerrit. For setting up gerritt, see https://wiki.opendaylight.org/view/OpenDaylight_Controller:Gerrit_Setup[Set up Gerrit]. 

NOTE: You will need to perform the Gerrit Setup before you can access git via ssh as described below. 

==== Pulling code via Git CLI

Pull the code by cloning the LispFlowMapping repository. 

`git clone ssh://<username>@git.opendaylight.org:29418/lispflowmapping.git`

or if you just want to do an anonymous git clone, you can use: 

`git clone https://git.opendaylight.org/gerrit/p/lispflowmapping.git`

==== Setting up Gerrit Change-id Commit Msg Hook 

This command inserts a unique Change-Id tag in the footer of a commit message. This step is optional but highly recommended for tracking changes. 

[source,perl]
cd lispflowmapping
scp -p -P 29418 <username>@git.opendaylight.org:hooks/commit-msg .git/hooks/
chmod 755 .git/hooks/commit-msg

==== Hacking the Code 

The following tasks are used to help you hack the code. 

*Setup Eclipse*

. Run Eclipse (Kepler is the current version).
. Open Git Repository perspective.
. Add an existing repository and choose the Lisp Flow Mapping repository that was pulled earlier.
. Import existing Maven projects and choose the following under the lispflowmapping directory:

    * api/pom.xl
    * implementation/pom.xml
	
*Build the code*

`mvn clean install`

To run without unitests you can skip building those tests running the following: 

[source,perl]
mvn clean install -DskipTests 
/* instead of "mvn clean install" */

*Run the controller*

[source,perl]
cd target/lispflowmapping-distribution-0.1.0-SNAPSHOT-osgipackage/opendaylight/
./run.sh

And point your browser at http://localhost:8080/ 


For complete documentation about running the controller, see https://wiki.opendaylight.org/view/OpenDaylight_Controller:Installation[Installation Guide].

==== Committing the Code using Git CLI

NOTE: To be accepted, all code must come with a http://elinux.org/Developer_Certificate_Of_Origin[developer certificate of origin] as expressed by having a Signed-off-by. A sign-off means that you are asserting, that you have made the change and you understand that the work was done as part of an open-source license. 

----
Developer's Certificate of Origin 1.1

        By making a contribution to this project, I certify that:

        (a) The contribution was created in whole or in part by me and I
            have the right to submit it under the open source license
            indicated in the file; or

        (b) The contribution is based upon previous work that, to the best
            of my knowledge, is covered under an appropriate open source
            license and I have the right under that license to submit that
            work with modifications, whether created in whole or in part
            by me, under the same open source license (unless I am
            permitted to submit under a different license), as indicated
            in the file; or

        (c) The contribution was provided directly to me by some other
            person who certified (a), (b) or (c) and I have not modified
            it.

        (d) I understand and agree that this project and the contribution
            are public and that a record of the contribution (including all
            personal information I submit with it, including my sign-off) is
            maintained indefinitely and may be redistributed consistent with
            this project or the open source license(s) involved.
----
			
*Mechanically you do it this way*:

`git commit --signoff`

You will be prompted for a commit message. If you are fixing a buzilla bug you can add that to your commit message and it will get linked from Gerrit: 


==========================
.For Example:

Fix for bug 2.

Signed-off-by: Ed Warnicke <eaw@cisco.com>

# Please enter the commit message for your changes. Lines starting + 
# with '#' will be ignored, and an empty message aborts the commit. + 
# On branch develop + 
# Changes to be committed: + 
#   (use "git reset HEAD <file>..." to unstage) + 
# + 
#       modified:   README + 
#
==========================

==== Pulling the Code changes via Git CLI

Use git pull to get the latest changes from the remote repository 

`git pull origin HEAD:refs/for/develop`

==== Pushing the Code via Git CLI

Use git push to push your changes back to the remote repository. 

`git push  origin HEAD:refs/for/develop`

You will get a message pointing you to your gerrit request like: 

==========================
remote: Resolving deltas: 100% (2/2) + 
remote: Processing changes: new: 1, refs: 1, done    + 
remote: + 
remote: New Changes: + 
remote:   http://git.opendaylight.org/gerrit/64 + 
remote: + 
==========================

==== Viewing your Changes in Gerrit

Follow the link you got above to see your commit in Gerrit: 

image::gerrit-code-review.jpg[Gerritt Code Review Sample]

Note that the Jenkins Controller User has verified your code and at the bottom is a link to the Jenkins build. 

Once your code has been reviewed and submitted by a committer it will be merged into the authoritative repo, which would look like this: 
 
image::gerrit-merged.jpg[Gerritt Code Merge Sample]

==== Troubleshooting

. *What to do if your Firewall blocks port 29418*

There have been reports that many corporate firewalls block port 29418. If that's the case, please follow the https://wiki.opendaylight.org/view/OpenDaylight_Controller:Setting_up_HTTP_in_Gerrit[Setting up HTTP in Gerrit] instructions and use git URL: 

`git clone https://<your_username>@git.opendaylight.org/gerrit/p/lispflowmapping.git`

You will be prompted for the password you generated in https://wiki.opendaylight.org/view/OpenDaylight_Controller:Setting_up_HTTP_in_Gerrit[Setting up HTTP in Gerrit].

All other instructions on this page remain unchanged.

To download pre-built images with ODP bootstraps see the following Github project: 

https://github.com/nerdalert/OpenDaylight-Lab[Pre-Built OpenDaylight VM Images]

==== Participating in the LISP Community 

* Join the https://lists.opendaylight.org/mailman/listinfo[ODP Listserv]
* Listen to the weekly Technical Work Stream meeting on https://wiki.opendaylight.org/view/Tech_Work_Stream:Main[Tech Work Stream:Main] . 
* Join the IRC channel #opendaylight on irc.freenode.net 







